
# Hacking into Vulnversity - TryHackMe
Vulnversity

Learn about active recon, web app attacks and privilege escalation.

https://tryhackme.com

# Index
* Reconnaissance
    - Nmap
    - whatweb
    - wafw00f
    - gobuster
* Gaining Access
    - Proxy
    - Burpsuite
    - Reverse-shell
    - TTY treatment
* Privilege escalation
    - SUID binaries
* Questionnaire



# Reconnaissance

## Nmap

Scan the open ports
```bash
nmap 10.10.64.159 -p1-65535 --open -T5 -n -oG openPorts.txt
```
![1!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/1.PNG?raw=true)

nmap: command, stands for Network Mapper<br>
10.10.64.159: target host IP <br>
-p1-65535: port range to scan, is like -p- <br>
--open: port status, report only open ports<br>
-T5: fast scan but more intrusive, on the other hand -T0 is slower but less intrusive<br>
-n: skip DNS resolution, it’s faster <br>
-oG fileName: grepable output exported to fileName. It is a simple format that lists each host on one line and can be trivially searched and parsed with standard Unix tools such as grep, awk, cut, sed, diff


```bash
nmap 10.10.64.159 -p1-65535 --open -sS --min-rate 4000 -vvv -n -Pn -oG ports2.txt 
```

-sS: SYN scan is the default and most popular scan option for good reasons. It can be performed quickly, scanning thousands of ports per second on a fast network not hampered by restrictive firewalls. It is also relatively unobtrusive and stealthy since it never completes TCP connections. This technique is often referred to as half-open scanning, because you don't open a full TCP connection. You send a SYN packet, as if           you are going to open a real connection and then wait for a response. A SYN/ACK indicates the port is listening (open), while a RST (reset) is indicative of a non-listener. If no response is received after several retransmissions, the port is marked as filtered. The port is also marked filtered if an ICMP unreachable error (type 3, code 0, 1, 2, 3, 9, 10, or 13) is received. The port is also considered open if a SYN packet (without the ACK flag) is received in response. This can be due to an extremely rare TCP feature known as a simultaneous open or split handshake connection (see https://nmap.org/misc/split-handshake.pdf).<br>

-sU: UDP Scan<br>

-v: verbose, show in the output ports discovered, otherwise you have to wait until the end of the scan<br>

--min-rate: When the --min-rate option is given Nmap will do its best to send packets as fast as or faster than the given rate. The argument is a positive real number representing a packet rate in packets per second. For example, specifying --min-rate 300 means that Nmap will try to keep the sending rate at or above 300 packets per second. Specifying a minimum rate does not keep Nmap from going faster if conditions warrant.<br>
<br>
-Pn (No ping): skips the host discovery stage altogether<br>

This option skips the host discovery stage altogether. Normally, Nmap uses this stage to determine active machines for heavier scanning and to gauge the speed of the network. By default, Nmap only performs heavy probing such as port scans, version detection, or OS detection against hosts that are found to be up. Disabling host discovery with -Pn causes Nmap to attempt the requested scanning functions against every target IP address specified. So if a /16 sized network is specified on the command line, all 65,536 IP addresses are scanned. Proper host discovery is skipped as with the list scan, but instead of stopping and printing the target list, Nmap continues to perform requested functions as if each target IP is active. Default timing parameters are used, which may result in slower scans. To skip host discovery and port scan, while still allowing NSE to run, use the two options -Pn -sn together. <br>

For machines on a local ethernet network, ARP scanning will still be performed (unless --disable-arp-ping or --send-ip is specified) because Nmap needs MAC addresses to further scan target hosts. In previous versions of Nmap, -Pn was -P0 and -PN. <br>
<br>
<br>
Enumerate services running; let’s see what is behind the open ports
```bash
nmap 10.10.64.159 -sC -sV -p21,22,139,445,3128,3333 -oN target.txt
```
![2!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/2.PNG?raw=true)

-sV: Probe open ports to determine service/version info<br>
-sC: Performs a script scan using the default set of scripts. It is equivalent to --script=default. Some of the scripts in this category are considered intrusive and should not be run against a target network without permission.<br>
-p <port ranges>: Only scan specified ports; For example: -p22; -p1-65535; -p U:53,111,137,T:21-25,80,139,8080,S:9<br>
--exclude-ports <port ranges>: Exclude the specified ports from scanning<br>
-oN <filename> (normal output):  Write output in Nmap's normal format to <filename>. This format is roughly the same as the standard interactive output printed by Nmap at runtime<br>

## whatweb 
Identify technologies used by the website.
```bash
whatweb http://10.10.64.159:3333
```
![3!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/3.PNG?raw=true)

WhatWeb recognises web technologies including content management systems (CMS), blogging platforms, statistic/analytics packages, JavaScript libraries, web servers, and embedded devices. WhatWeb has over 1800  plugins,  each  to  recognise  something  different. WhatWeb also identifies version numbers, email addresses, account ID's, web framework modules, SQL errors, and more.

## wafw00f 
Identify and fingerprint Web Application Firewall products
```bash
wafw00f http://10.10.64.159:3333/
```
![4!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/4.PNG?raw=true)

wafw00f Sends  a normal HTTP request and analyses the response; this identifies a number of WAF solutions.  If that is not successful, it sends a number of (potentially malicious) HTTP requests and uses simple logic to deduce which WAF it is.  If that is also not successful, it analyses the responses previously returned and uses another simple algorithm to guess if a WAF or security solution is active><br>
The server has no web application firewall
  <br>
  <br>

Let’s see the webpage: browser > ip:port
  <br>
  
  ![5!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/5.PNG?raw=true)
  
  Don’t forget to add time to the machine’s deployment on the TryHackMe website 
  <br>
  
  ![5.1!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/5.1.PNG?raw=true)
  
## gobuster 
Now we can enumerate directories on the web server
<br>
  
https://github.com/OJ/gobuster
<br>
```bash
gobuster dir -u http://10.10.64.159:3333/ -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt
```
![6!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/6.PNG?raw=true)

Gobuster is a tool used to brute-force:<br>
URLs (directories and files) in web sites.<br>
DNS subdomains (with wildcard support).<br>
Virtual Host names on target web servers.<br>
Open Amazon S3 buckets<br>

![6.1!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/6.1.PNG?raw=true)

dir: Uses directory/file enumeration mode<br>
-u: target URL<br>
-w: path to wordlist / dictionary to perform the bruteforce attack<br>
-t, --threads int: Number of concurrent threads (default 10)<br>

Gobuster doesn’t do recursive brute force, It’s written in Go, a good language to work with sockets and connections, faster than an interpreted script (such as Python)<br>
<br>
We find the internal/ subdirectory and the uploads/ subdirectory<br> 
![9!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/9.PNG?raw=true)
  
# Gaining Access
Parrot OS already has reverse-shells but we could download a new one from the internet<br>

http://pentestmonkey.net/tools/php-reverse-shell<br>
    
![11!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/11.PNG?raw=true)<br>
<br>
Let’s try to upload a .php payload to the server<br>
![12!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/12.PNG?raw=true)<br>
<br>
The .php extension is not allowed
![13!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/13.PNG?raw=true)

## Proxy
We have to know which type of extensions we are allowed to upload, in order to do that, we can use Burpsuite tool, but first we have to set up a proxy configuration for burpsuite to be able to intercept the request, we can use FoxyProxy or use a manual configuration on the browser <br>
Mozilla > Preferences > General > Network Settings > Settings<br>

![15!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/15.PNG?raw=true)
  
Once we are done using Burpsuite, we can stop using the proxy by configuring “no proxy” on Mozilla browser <br>
If we try to enter google we are going to get a Certificate error, to solve it, we go to our proxy web http://127.0.0.1:8080/, and click on CA Certificate, and save the file<br><br>
![16!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/16.PNG?raw=true)
  
Mozilla > Preferences > Privacy and Security > Security > Certificates > View Certificates<br>

![17!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/17.PNG?raw=true)
  
Import the downloaded cert
<br>  
![18!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/18.PNG?raw=true)
  
![19!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/19.PNG?raw=true)
  
Trust this CA, ok, ok<br>

![20!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/20.PNG?raw=true)  
<br>
Now we will not have any certificate error when using Burpsuite
  
## Burpsuite
Open burpsuite to fuzz the upload form and see what file type is allowed in order to upload our payload<br>

Open Burpsuite with the proxy active<br>

![10!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/10.PNG?raw=true)  
  
Use Burp Defaults, Start Burpsuite, turn on Interception<br>
Burpsuite > Proxy > Intercept > click Intercept is off<br><br>
![14!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/14.PNG?raw=true)  
  
Try to submit the php reverse shell payload to the server again, this time burpsuite intercepts the request, as soon as we click submit, the webpage will be loading and Burpsuite pops up with our request<br>
  
Right click, send to intruder, used for automating customised attacks<br>

![21!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/21.PNG?raw=true)  
  
Tab Intruder > Positions, click on “Clear” on the right<br>
Select the "Sniper" attack type.<br>
<br>
![21.1!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/21.1.PNG?raw=true)  
  
We are going to make a kind of bruteforce attack to see what file extensions are allowed<br>
Select on filename line the extension of our file, .php, and click on Add on the right<br>

![22!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/22.PNG?raw=true)  
  
Now we get the wildcard symbol on the chain, burpsuite will change this part of the chain with each word in the dictionary to find out which extension is allowed <br>
  
![23!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/23.PNG?raw=true)  
  
This way we are indicating burpsuite where to change the chain with the words in a dictionary to perform the bruteforce attack<br>
Here we can download wordlists: https://github.com/danielmiessler/SecLists<br>
https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/raft-small-extensions-lowercase.txt<br><br>
Download the dictionary directly with the terminal in the raw version on github<br>
<br>
```bash
wget https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/raft-small-extensions-lowercase.txt
```

![24!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/24.PNG?raw=true)  
  
Now we go to BurpSuite  > tab Intruder > Payloads, here we configure the attack and select the dictionary / wordlist, in payload options load the wordlist<br>

![25!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/25.PNG?raw=true)  

And open “raft-small-extensions-lowercase.txt” which is a wordlist that contains file extension names<br>
Uncheck the option URL encode<br>
  
![26!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/26.PNG?raw=true)  
  
Click Start attack at the top right on the BurpSuite graphical interface in orange colour<br>
  
![27!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/27.PNG?raw=true)  
  
BurpSuite is trying combinations<br>
  
![28!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/28.PNG?raw=true)  
  
We see that for the .phtml extension the Length is different, .phtml is allowed<br>
Now we are done using Burpsuite, so we can close it and stop using Proxy on the Mozilla settings<br>
  
![29!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/29.PNG?raw=true)  
  
We see that the .phtml extension is allowed<br>
  
## Reverse-shell
Change the payload extension from php to phtml<br>
```bash
cp /usr/share/webshells/php/php-reverse-shell.php /home/roberto/Downloads/php-reverse-shell.phtml
```
![30!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/30.PNG?raw=true)  
  
Now we have to make the payload connect to us, so we have to add our IP address and a port number, we can use the port 443, that port is usually allowed by the firewall, and the IP address is the tun0 interface address<br>
```bash
nano /home/Roberto/Downloads/php-reverse-shell.phtml 
```

![31!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/31.PNG?raw=true)  
  
Upload the payload<br>
  
![32!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/32.PNG?raw=true) 
  
We see we can upload the reverse shell with the .phtml extension<br>

![34!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/34.PNG?raw=true) 
  
Now we have to listen on that port, the 443 port, that we indicated on the payload’s code<br>
  
![35!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/35.PNG?raw=true) 
  
netcat  is  a  simple  unix utility which reads and writes data across network connections, using TCP or UDP protocol<br>
-l: listen mode, for inbound connects<br>
-v: verbose, gives information on the output [use twice to be more verbose]<br>
-n: numeric-only IP addresses, no DNS<br>
-p port: local port number (port numbers can be individual or ranges: lo-hi [inclusive])<br><br>

And on the web server click php-reverse-shell.phtml , for the payload to execute the reverse connection to us<br>
A reverse shell works by being called on the remote host and forcing this host to make a connection to you. So you'll listen for incoming connections and control the remote server when the connection gets established <br>
The reverse shell payload has code to make this possible <br>
  
![36!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/36.PNG?raw=true) 
  
As soon as we click we get the connection <br>
  
![37!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/37.PNG?raw=true) 
  
We are now on the remote server with the www-data user<br>
  
![38!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/38.PNG?raw=true) 
  
## TTY treatment
But this TTY is no fully functional yet...<br>
<br>
    
![39!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/39.PNG?raw=true) 
  
Make the TTY fully interactive<br>
  
![40!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/40.PNG?raw=true) 
  
fg (enter)<br>
  
![40.1!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/40.1.PNG?raw=true) 
  
(enter)<br>
  
![41!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/41.PNG?raw=true) 
  
If we open nano we see the wrong proportions<br>
  
![42!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/42.PNG?raw=true) 
  
Set the right proportions, open a new terminal in our system<br>
  
![43!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/43.PNG?raw=true) 
  
And we can set how many rows and columns we are using<br>
  
![44!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/44.PNG?raw=true) 
  
If we open the nano text editor now we see that we have the right proportions<br>
  
![45!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/45.PNG?raw=true) 
  
Now we got a fully interactive TTY and the arrow keys are functional and the proportions are right<br>
  
# Privilege escalation
With the user that we got inside the machine, www-data, we can access some parts of the system<br>
And we see the user.txt flag<br>

![46!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/46.PNG?raw=true) 
  
# SUID binaries
Now we have to get root access, privilege escalation, on this linux machine, we are going to exploit SUID binaries in order to get maximum access, let’s see what binaries are there that have SUID permissions<br>

In Linux, SUID (set owner userId upon execution) is a special type of file permission given to a file. SUID gives temporary permissions to a user to run the program/file with the permission of the file owner (rather than the user who runs it).<br>
  
For example, the binary file to change your password has the SUID bit set on it (/usr/bin/passwd). This is because to change your password, it will need to write to the shadowers file that you do not have access to, root does, so it has root privileges to make the right changes.<br>
  
```bash
find / -perm -4000 2>/dev/null
```
  
![50!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/50.PNG?raw=true) 
  
This website https://gtfobins.github.io/ has a list of binaries and how to use them to do the privilege escalation to get permissions; we are going to search this binaries from the list above to see if any of them can be exploited<br>
For the sudo command we don’t see any result<br>
    
![50.1!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/50.1.PNG?raw=true) 
  
But we find something with systemctl<br>
  
![50.2!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/50.2.PNG?raw=true) 
  
The website has even an explanation<br>
  
![51!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/51.PNG?raw=true) 
  
We are going to set SUID permissions on the bash<br>
  
![52!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/52.PNG?raw=true)  
  
We can copy and edit the vulnerability code<br>
  
![53!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/53.PNG?raw=true)  
  
But change the command and the binary<br>
  
![54!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/54.PNG?raw=true)  
  
Once the code has been edited, we can execute it and see that /bin/bash now has SUID permissions<br>
  
![55!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/55.PNG?raw=true)  
  
bash -p and we see we have root permissions, we’ve escalated privileges <br>
  
![56!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/56.PNG?raw=true)  
  
We list the directories, and we find the root.txt flag<br>
  
![57!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/57.PNG?raw=true)  
  
We check the root flag is correct<br>
  
![58!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/58.PNG?raw=true)  
  
And we have finished this machine<br>
  
![59!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/59.PNG?raw=true) 
  
We are done!<br>
  
# Questionnaire 
Now on TryHackMe we have some questions <br>
    
![7!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/7.PNG?raw=true) 
![8!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/8.PNG?raw=true) 
![47!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/47.PNG?raw=true) 
![48!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/48.PNG?raw=true) 
![49!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/49.PNG?raw=true) 
![58!](https://github.com/Roberto-Bruna/TryHackMe---Offensive-Pentesting-Learning-Path/blob/main/1-Vulnversity/images/58.PNG?raw=true) 
